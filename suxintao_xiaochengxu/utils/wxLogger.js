 "use strict";Date.now=Date.now||function(){return(new Date).getTime()};var SEQUENCE=Date.now(),noop=function(){},$a1=function(){var t="object"==typeof console?console.warn:noop;try{var e={warn:t};e.warn.call(e)}catch(r){return noop}return t},util={noop:noop,warn:$a1(),key:"__bl",win:"object"==typeof window&&window.document?window:undefined,regionMap:{cn:"https://arms-retcode.aliyuncs.com/r.png?",sg:"https://arms-retcode-sg.aliyuncs.com/r.png?",sg_2:"https://retcode-sg-lazada.arms.aliyuncs.com/r.png?",daily:"http://arms-retcode-daily.alibaba.net/r.png?",daily_2:"https://arms-retcode-daily.alibaba.net/r.png?",us:"https://retcode-us-west-1.arms.aliyuncs.com/r.png?"},defaultImgUrl:"https://arms-retcode.aliyuncs.com/r.png?",$a2:function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e},each:function(t,e){var r=0,n=t.length;if(this.T(t,"Array"))for(;r<n&&!1!==e.call(t[r],t[r],r);r++);else for(r in t)if(!1===e.call(t[r],t[r],r))break;return t},$a3:function(t,e,r){if("function"!=typeof t)return r;try{return t.apply(this,e)}catch(n){return r}},T:function(t,e){var r=Object.prototype.toString.call(t).substring(8).replace("]","");return e?r===e:r},$a4:function(t,e){if(!t)return"";if(!e)return t;var r=this,n=r.T(e);return"Function"===n?r.$a3(e,[t],t):"Array"===n?(this.each(e,function(e){t=r.$a4(t,e)}),t):"Object"===n?t.replace(e.rule,e.target||""):t.replace(e,"")},$a5:function(t,e){if(!t||!e)return!1;if((this.isString(e)||e.source||"Function"===this.T(e))&&(e=[e]),!this.isArray(e))return util.warn("[arms] invalid rules of ignore config, (list of) String/RegExp/Funcitons are available"),!1;for(var r,n=[],i=0,o=e.length;i<o;i++)if(r=e[i],this.isString(r))n.push(r.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"));else if(r&&r.source)n.push(r.source);else if(r&&"Function"===this.T(r)&&!0===this.$a3(r,[t],!1))return!0;var a=new RegExp(n.join("|"),"i");return!!(n.length&&a.test&&a.test(t))},J:function(t){if(!t||"string"!=typeof t)return t;var e=null;try{e=JSON.parse(t)}catch(r){}return e},pick:function(t){return 1===t||1===Math.ceil(Math.random()*t)},$a6:function(t){if("sample"in t){var e=t.sample,r=e;e&&/^\d+(\.\d+)?%$/.test(e)&&(r=parseInt(100/parseFloat(e))),0<r&&1>r&&(r=parseInt(1/r)),r>=1&&r<=100?t.sample=r:delete t.sample}return t},on:function(t,e,r,n){return t.addEventListener?t.addEventListener(e,function i(o){n&&t.removeEventListener(e,i,!1),r.call(this,o)},!1):t.attachEvent&&t.attachEvent("on"+e,function o(i){n&&t.detachEvent("on"+e,o),r.call(this,i)}),this},off:function(t,e,r){return r?(t.removeEventListener?t.removeEventListener(e,r):t.detachEvent&&t.detachEvent(e,r),this):this},delay:function(t,e){return-1===e?(t(),null):setTimeout(t,e||0)},ext:function(t){for(var e=1,r=arguments.length;e<r;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},sub:function(t,e){var r={};return this.each(t,function(t,n){-1!==e.indexOf(n)&&(r[n]=t)}),r},uu:function(){for(var t,e,r=20,n=new Array(r),i=Date.now().toString(36).split("");r-- >0;)e=(t=36*Math.random()|0).toString(36),n[r]=t%3?e:e.toUpperCase();for(var o=0;o<8;o++)n.splice(3*o+2,0,i[o]);return n.join("")},seq:function(){return(SEQUENCE++).toString(36)},encode:function(t,e){try{t=e?encodeURIComponent(t).replace(/\(/g,"%28").replace(/\)/g,"%29"):encodeURIComponent(t)}catch(r){}return t},serialize:function(t){t=t||{};var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&t[r]!==undefined&&e.push(r+"="+this.encode(t[r],"msg"===r));return e.join("&")},$a7:function(t,e){if(!t||"string"!=typeof t)return!1;var r=/arms-retcode[\w-]*\.aliyuncs/.test(t);return!r&&e&&(r=/(\.png)|(\.gif)|(alicdn\.com)/.test(t)),!r},$a8:function(t){return!(!t||!t.message)&&!/failed[\w\s]+fetch/i.test(t.message)},$a9:function(t){return t&&"string"==typeof t?t.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,""):""},$aa:function(t){return function(){return t+"() { [native code] }"}},checkSameOrigin:function(t,e){if(!e||!t)return!1;var r="//"+e.split("/")[2];return t===e||t.slice(0,e.length+1)===e+"/"||t===r||t.slice(0,r.length+1)===r+"/"||!/^(\/\/|http:|https:).*/.test(t)},getRandIP:function(){for(var t=[],e=0;e<4;e++){var r=Math.floor(256*Math.random());t[e]=(r>15?"":"0")+r.toString(16)}return t.join("")},getSortNum:function(t){return t?(t+=1)>=1e3&&t<=9999?t:t<1e3?t+1e3:t%1e4+1e3:1e3},getRandNum:function(t){return t&&"string"==typeof t?t.length<5?this.getNum(5):t.substring(t.length-5):this.getNum(5)},getNum:function(t){for(var e=[],r=0;r<t;r++){var n=Math.floor(16*Math.random());e[r]=n.toString(16)}return e.join("")},isFunction:function(t){return"function"==typeof t},isPlainObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isString:function(t){return"[object String]"===Object.prototype.toString.call(t)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},joinRegExp:function(t){for(var e,r=[],n=0,i=t.length;n<i;n++)e=t[n],this.isString(e)?r.push(e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):e&&e.source&&r.push(e.source);return new RegExp(r.join("|"),"i")}},util_1=util,pushToQueue=function(t,e){var r;{if("error"!==e.t||!(r=t.$ab[0])||"error"!==r.t||e.msg!==r.msg)return t.$ab.unshift(e),t.$ac(function(){t.$ad=util_1.delay(function(){t.$ae()},"error"===e.t?3e3:-1)}),!0;r.times++}},Base=function(t){return this.ver="1.5.5",this._conf=util_1.ext({},Base.dftCon),this.$af={},this.$ab=[],this.hash=util_1.seq(),this.$ag(),this.setConfig(t),this.rip=util_1.getRandIP(),this.record=999,this["EagleEye-TraceID"]=this.getTraceId()["EagleEye-TraceID"],this._common={},this};Base.dftCon={sample:1,tag:"",imgUrl:"https://arms-retcode.aliyuncs.com/r.png?",region:null,ignore:{ignoreUrls:[],ignoreApis:[],ignoreErrors:[]},release:undefined,environment:"production"},Base.prototype={constructor:Base,$ac:function(t){return t()},$ah:function(){var t=this._conf.page;return util_1.$a3(t,[],t+"")},setPage:function(){},setConfig:function(t){t&&"object"==typeof t&&(util_1.$a6(t),t=this.$ai(t),this._conf=util_1.ext({},this._conf,t))},$ai:function(t){var e=t.region,r=t.imgUrl;if(e){var n=util_1.regionMap[e];return t.imgUrl=n||util_1.defaultImgUrl,t}return r&&(t.imgUrl=r),t},$aj:function(t){if(this.getConfig("debug"))return!0;var e=util_1.regionMap,r=!1;for(var n in e)if(e[n]===t){r=!0;break}return!r&&util_1.warn("[retcode] invalid url: "+t),r},$ak:function(){},$al:function(){},$am:function(){return{}},setCommonInfo:function(t){t&&"object"==typeof t&&(this._common=util_1.ext({},this._common,t))},$ag:function(){this.session=util_1.uu(),this.sBegin=Date.now()},getTraceId:function(){var t=this.rip,e=Date.now(),r=util_1.getSortNum(this.record),n=t+e+r+util_1.getRandNum(this._conf.pid);return this["EagleEye-TraceID"]=n,this.record=r,{"EagleEye-TraceID":n}},getSessionId:function(){return{"EagleEye-SessionID":this.session}},getConfig:function(t){return t?this._conf[t]:util_1.ext({},this._conf)},$an:function(t){return 1===t||("boolean"==typeof this.$af[t]?this.$af[t]:(this.$af[t]=util_1.pick(t),this.$af[t]))},$ae:function(){var t;for(clearTimeout(this.$ad),this.$ad=null;t=this.$ab.pop();)"res"===t.t?this.$al(t,"res"):"error"===t.t?this.$al(t,"err"):this.$ak(t);return this},_lg:function(t,e,r){var n=this._conf,i=this.$ah(),o=n.ignore||{},a=o.ignoreErrors,s=o.ignoreUrls,u=o.ignoreApis;return util_1.$a5(i,s)?this:"error"===t&&util_1.$a5(e.msg,a)?this:"api"===t&&util_1.$a5(e.api,u)?this:this.$aj(n.imgUrl)&&e&&!n.disabled&&n.pid?r&&!this.$an(r)?this:(e=util_1.ext({t:t,times:1,page:i,tag:n.tag||"",begin:Date.now()},e,this.$am(),this._common,{pid:n.pid,_v:this.ver,sid:this.session,sampling:r||1,z:util_1.seq()}),pushToQueue(this,e)):this},custom:function(t,e){if(!t||"object"!=typeof t)return this;var r=!1,n={begin:Date.now()};return util_1.each(t,function(t,e){return!(r=e&&e.length<=20)&&util_1.warn("[retcode] invalid key: "+e),n["x-"+e]=t,r}),r?this._lg("custom",n,e||1):this}};var base=Base,validApiKeys=["api","success","time","code","msg","trace","traceId","begin","sid","seq"],parseStatData=function(t,e){var r=t.split("::");return r.length>1?util_1.ext({group:r[0],key:r[1]},e):util_1.ext({group:"default_group",key:r[0]},e)},Reporter=function(t){base.call(this,t);var e;try{e="object"==typeof performance?performance.timing.fetchStart:Date.now()}catch(r){e=Date.now()}return this._startTime=e,this};Reporter.prototype=util_1.$a2(base.prototype),util_1.ext(base.dftCon,{startTime:null}),util_1.ext(Reporter.prototype,{constructor:Reporter,_super:base,sum:function(t,e,r){try{return this._lg("sum",parseStatData(t,{val:e||1,begin:Date.now()}),r)}catch(n){util_1.warn("[retcode] can not get parseStatData: "+n)}},avg:function(t,e,r){try{return this._lg("avg",parseStatData(t,{val:e||0,begin:Date.now()}),r)}catch(n){util_1.warn("[retcode] can not get parseStatData: "+n)}},percent:function(t,e,r,n){try{return this._lg("percent",parseStatData(t,{subkey:e,val:r||0,begin:Date.now()}),n)}catch(i){util_1.warn("[retcode] can not get parseStatData: "+i)}},msg:function(t,e){if(t&&!(t.length>180))return this.custom({msg:t},e)},error:function(t,e){if(!t)return util_1.warn("[retcode] invalid param e: "+t),this;1===arguments.length?("string"==typeof t&&(t={message:t},e={}),"object"==typeof t&&(e=t=t.error||t)):("string"==typeof t&&(t={message:t}),"object"!=typeof e&&(e={}));var r=t.name||"CustomError",n=t.message,i=t.stack||"";e=e||{};var o={begin:Date.now(),cate:r,msg:n.substring(0,1e3),stack:i&&i.substring(0,1e3),file:e.filename||"",line:e.lineno||"",col:e.colno||"",err:{msg_raw:n,stack_raw:i}};return this.$aq&&this.$aq("error",o),this._lg("error",o,1)},api:function(t,e,r,n,i,o,a,s){return t?(t="string"==typeof t?{api:t,success:e,time:r,code:n,msg:i,begin:o,traceId:a,sid:s}:util_1.sub(t,validApiKeys),util_1.$a7(t.api)?(t.code=t.code||"",t.msg=t.msg||"",t.success=t.success?1:0,t.time=+t.time,t.begin=t.begin,t.traceId=t.traceId||"",t.sid=t.sid||"",!t.api||isNaN(t.time)?(util_1.warn("[retcode] invalid time or api"),this):(this.$aq&&this.$aq("api",t),this._lg("api",t,t.success&&this.getConfig("sample")))):this):(util_1.warn("[retcode] api is null"),this)},speed:function(t,e,r){var n=this,i=this.getConfig("startTime")||this._startTime;return/^s(\d|1[0])$/.test(t)?(e="number"!=typeof e?Date.now()-i:e>=i?e-i:e,n.$ao=n.$ao||{},n.$ao[t]=e,n.$ao.begin=i,clearTimeout(n.$ap),n.$ap=setTimeout(function(){r||(n.$ao.page=n.$ah(!0)),n._lg("speed",n.$ao),n.$ao=null},5e3),n):(util_1.warn("[retcode] invalid point: "+t),n)}}),Reporter._super=base,Reporter._root=base,base.Reporter=Reporter;var reporter=Reporter,MiniProgramLogger=function(t){t&&t.pid||util_1.warn("[arms] pid is a required prop to instatiate MiniProgramLogger");var e=this;return reporter.call(e,t),e._health={errcount:0,apisucc:0,apifail:0},e.DEFAUT_PAGE_PATH="[app]",e.isSendPerf=!1,e.$aq=function(t,r){"error"===t?e._health.errcount++:"api"===t&&e._health[r.success?"apisucc":"apifail"]++},"function"==typeof e.$ar&&e.$ar(),"function"==typeof e.$as&&e.$as(),this};MiniProgramLogger.prototype=util_1.$a2(reporter.prototype),util_1.ext(reporter._root.dftCon,{uid:null,disableHook:!1,enableLinkTrace:!1,sendRequest:function(){},getCurrentPage:function(){}}),util_1.ext(MiniProgramLogger.prototype,{constructor:MiniProgramLogger,_super:reporter,$ac:function(t){t()},$ak:function(t,e){if(this.getConfig("debug"))"undefined"!=typeof console&&console&&"function"==typeof console.log&&console.log("[arms] [DEBUG MODE] log data",t);else{var r=this.getConfig("imgUrl");"object"==typeof t&&(t=util_1.serialize(t));var n=r+t;e&&(n+="&post_res=");var i=this._conf.sendRequest;if("function"==typeof i)try{i(n,e)}catch(o){util_1.warn("[arms] error in $ak",o)}}},$al:function(t,e){var r={};r[e]=t[e],delete t[e],this.$ak(t,r)},$ah:function(){var t=this._conf.getCurrentPage;if("function"==typeof t)try{var e=t();if(e&&"string"==typeof e)return e}catch(r){util_1.warn("[arms] error in $ah",r)}return"string"==typeof t&&t?t:this.DEFAUT_PAGE_PATH},setConfig:function(t){if(t&&"object"==typeof t){util_1.$a6(t),t=this.$ai(t);var e=this._conf;this._conf=util_1.ext({},this._conf,t);var r="disableHook";r in t&&e[r]!==t[r]&&(t[r]?"function"==typeof this.removeHook&&this.removeHook():"function"==typeof this.addHook&&this.addHook())}},pageShow:function(){var t=this;t.$ag(),t.$at(),clearTimeout(t.$au),t.$av(),t.$au=setTimeout(function(){t.$aw()},10),t.sessionPage=t.$ah()},pageHide:function(){this.$av()},addHook:function(){return this},removeHook:function(){return this},hookApp:function(t){var e=this,r={onError:function(r){var n=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),i=t.onError;try{e.error(r)}catch(r){util_1.warn("[arms] error in hookApp:onError",r)}if("function"==typeof i)return i.apply(this,n)}};return util_1.ext({},t,r)},hookPage:function(t){var e=this,r={onShow:function(){var r=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),n=t.onShow;try{e.pageShow()}catch(i){util_1.warn("[arms] error in hookPage:pageShow",i)}if("function"==typeof n)return n.apply(this,r)},onHide:function(){var r=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),n=t.onHide;try{e.pageHide()}catch(i){util_1.warn("[arms] error in hookPage:onHide",i)}if("function"==typeof n)return n.apply(this,r)},onUnload:function(){var r=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),n=t.onUnload;try{e.pageHide()}catch(i){util_1.warn("[arms] error in hookPage:onUnload",i)}if("function"==typeof n)return n.apply(this,r)}};return util_1.ext({},t,r)},$ar:function(){},$as:function(){this.setCommonInfo({app:"mini_common",uid:this._conf.uid})},$aw:function(){var t=this;t.$ac(function(){t._lg("pv",{})})},$at:function(){var t=this;t.isSendPerf||(t.$ac(function(){var e={fpt:Date.now()-t.sBegin};t._lg("perf",e)}),t.isSendPerf=!0)},$av:function(){this.$ax(),this.$ao&&(this._lg("speed",this.$ao),this.$ao=null,clearTimeout(this.$ap)),this.$ae()},$ax:function(){if(this.sessionPage){var t=util_1.ext({},this._health);t.healthy=t.errcount>0?0:1,t.begin=Date.now();var e=t.begin-this.sBegin;t.page=this.sessionPage,t.stay=e,this._lg("health",t,1),this._health={errcount:0,apisucc:0,apifail:0},this.sessionPage=null}}});var singleton=null,generator=function(t){return singleton||(singleton=new MiniProgramLogger(t||{})),singleton};MiniProgramLogger.init=generator,MiniProgramLogger.singleton=generator,MiniProgramLogger._super=reporter,MiniProgramLogger._root=reporter._root,reporter.MiniProgramLogger=MiniProgramLogger;var miniProgramLogger=MiniProgramLogger,hook=function(t){var e=util_1,r=null,n={};return e.ext(t.prototype,{addHook:function(){return this.isHookInstantiated?this:(function(){var t=this;if("undefined"!=typeof wx&&wx&&"function"==typeof wx.request){r=wx;var i={request:function(r){var n=(new Date).getTime();if(r&&"object"==typeof r&&r[0]){var i,o,a=r[0],s=e.$a9(a.url),u=a.success,c=a.fail,g=a&&a.header;g&&"object"==typeof g||(g={});var l={};if(t.getConfig("enableLinkTrace")){var f=g["EagleEye-pAppName"];if(i=g["EagleEye-TraceID"],o=g["EagleEye-SessionID"],i||(i=t.getTraceId()["EagleEye-TraceID"],l["EagleEye-TraceID"]=i),o||(o=t.getSessionId()["EagleEye-SessionID"],l["EagleEye-SessionID"]=o),!f){var p=t.getConfig("pid");l["EagleEye-pAppName"]=p}}a.success=function(){var a=(new Date).getTime();if(e.$a7(s,!0)){var c=arguments&&arguments[0]&&arguments[0].statusCode||200;t.api({api:r[0].url,success:!0,time:a-n,code:c,begin:n,traceId:i,sid:o})}u&&u.apply(t,[].slice.call(arguments))},a.fail=function(){var a=(new Date).getTime();if(e.$a7(s,!0)){var u="";arguments&&arguments[0]&&"object"==typeof arguments[0]&&(u=(u=JSON.stringify(arguments[0])).substring(0,1e3));var g=arguments&&arguments[0]&&arguments[0].statusCode||"FAILED";t.api({api:r[0].url,success:!1,time:a-n,code:g,msg:u,begin:n,traceId:i,sid:o})}c&&c.apply(t,[].slice.call(arguments))},a.header=e.ext({},g,l)}}};for(var o in wx)if(i[o]){var a=o.toString();n[a]=function(){return i[a](arguments),r[a].apply(r,[].slice.call(arguments))}}else n[o]=r[o];wx=n}}.call(this),this.isHookInstantiated=!0,this)},removeHook:function(){return this.isHookInstantiated?(function(){"undefined"!=typeof wx&&wx&&r&&(wx=r,r=null)}.call(this),this.isHookInstantiated=!1,this):this},$ar:function(){return this.$ay?this:(this.getConfig("disableHook")||this.addHook(),this.$ay=!0,this)}}),t},ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY="ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY",WXLogger=function(t){return miniProgramLogger.call(this,t),this};WXLogger.prototype=util_1.$a2(miniProgramLogger.prototype),util_1.ext(miniProgramLogger._root.dftCon,{sendRequest:function(t,e){if("undefined"!=typeof wx&&wx&&"function"==typeof wx.request)try{var r,n="GET";e&&(n="POST",r=JSON.stringify(e)),wx.request({url:t,method:n,data:r,fail:function(t){util_1.warn("[arms] sendRequest fail",t)}})}catch(i){util_1.warn("[arms] error in conf sendRequest",i)}},getCurrentPage:function(){if("function"==typeof getCurrentPages)try{var t=getCurrentPages()||[],e=t[t.length-1];return e&&e.route||null}catch(r){util_1.warn("[arms] error in conf getCurrentPage",r)}}}),util_1.ext(WXLogger.prototype,{constructor:WXLogger,_super:miniProgramLogger,$as:function(){this.setCommonInfo({app:"mini_wx"}),this.$az(),this.$b0(),this.$b1()},$b1:function(){if(this._conf&&this._conf.uid)this.setCommonInfo({uid:this._conf.uid});else if("undefined"!=typeof wx&&wx&&"function"==typeof wx.getStorageSync)try{var t=wx.getStorageSync(ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY);if(t&&"string"==typeof t)this.setCommonInfo({uid:t});else if("function"==typeof wx.setStorageSync){var e=util_1.uu();wx.setStorageSync(ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY,e),this.setCommonInfo({uid:e})}}catch(r){util_1.warn("[arms] error in $b1",r)}},$az:function(){if("undefined"!=typeof wx&&wx&&"function"==typeof wx.getSystemInfoSync)try{var t=wx.getSystemInfoSync();"object"==typeof t&&this.setCommonInfo({sr:(t.screenWidth||0)+"x"+(t.screenHeight||0),vp:(t.windowWidth||0)+"x"+(t.windowHeight||0),dpr:t.pixelRatio,ul:t.language})}catch(e){util_1.warn("[arms] error in $az",e)}},$b0:function(){var t=this;if("undefined"!=typeof wx&&wx&&"function"==typeof wx.getNetworkType)try{wx.getNetworkType({success:function(e){e&&"string"==typeof e.networkType&&t.setCommonInfo({ct:e.networkType})},fail:function(t){util_1.warn("[arms] $b0 getNetworkType fail",t)}})}catch(e){util_1.warn("[arms] error in $b0",e)}},hookApp:function(t){var e=this,r={onError:function(r){var n=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),i=t.onError;try{if(r&&"object"==typeof r&&e.error(r),r&&"string"==typeof r){var o=r.split("\n"),a="",s="";o.length>1&&(a=o[0]&&o[0].length<100?o[0]:o[0].substring(0,100),s=o[1]),e.error({name:a,message:s||r,stack:r})}}catch(r){util_1.warn("[arms] error in hookApp:onError",r)}if("function"==typeof i)return i.apply(this,n)}};return util_1.ext({},t,r)}}),hook(WXLogger);var singleton$1=null,generator$1=function(t){return singleton$1||(singleton$1=new WXLogger(t||{})),singleton$1};WXLogger.init=generator$1,WXLogger.singleton=generator$1,WXLogger._super=miniProgramLogger,WXLogger._root=miniProgramLogger._root,miniProgramLogger.WXLogger=WXLogger;var clazz=WXLogger;module.exports=clazz;